"use strict";(self.webpackChunkreact_widget_template=self.webpackChunkreact_widget_template||[]).push([[754],{768:(e,t,n)=>{n.d(t,{A:()=>w});var o=n(9379),s=n(5043),i=n(8931),a=n(7111),l=n(3585),r=n(6800),c=n(1648),d=n(3003),g=n(3728),u=n(5645),m=n(6047),p=n(1024),h=n(579);const f=e=>{let{header:t,columns:n,table:s}=e;const a="selection"===t.column.id,l=s.getState().columnPinning.left.includes(t.column.id),r=a?"is-fixed":l?"is-pinned":"",d=(0,c.gl)({id:t.column.id,disabled:"selection"===t.column.id||"EIN"===t.column.id}),{attributes:g,listeners:u,setNodeRef:m,transform:f,isDragging:v}=a?{attributes:{},listeners:{},setNodeRef:null,transform:null,isDragging:!1}:d,x={opacity:v?.8:1,position:"sticky",top:0,left:a?0:l?"var(--pinned-left)":"auto",transform:p.Ks.Transform.toString(f),transition:"width transform 0.2s ease-in-out",width:t.getSize(),zIndex:a?5:l?4:3,cursor:a?"default":"move",backgroundColor:"#f2f2f2"};return(0,h.jsxs)("th",{ref:m,style:x,"data-fixed":a,"data-pinned":l,className:r,children:[(0,h.jsx)("div",(0,o.A)((0,o.A)({className:"d-flex align-items-center header-content"},a?{}:(0,o.A)((0,o.A)({},g),u)),{},{children:(0,h.jsxs)("div",{className:"flex-grow-1",onClick:t.column.getToggleSortingHandler(),children:[t.isPlaceholder?null:(0,i.Kv)(t.column.columnDef.header,t.getContext()),"asc"===t.column.getIsSorted()?(0,h.jsx)("span",{className:"icon",children:"\u2191"}):"desc"===t.column.getIsSorted()?(0,h.jsx)("span",{className:"icon",children:"\u2193"}):null]})})),(0,h.jsx)("div",{onDoubleClick:()=>t.column.resetSize(),onMouseDown:t.getResizeHandler(),onTouchStart:t.getResizeHandler(),className:"Resizer ".concat(t.column.getIsResizing()?"isResizing":"")})]})},v=e=>{let{cell:t,columns:n,changedCells:o}=e;const s="selection"===t.column.id,a=t.column.getIsPinned(),l=s?"is-fixed":a?"is-pinned":"",r=(0,i.Kv)(t.column.columnDef.cell,t.getContext()),d=t.column.id.split("_").slice(1).join("_")||t.column.id,g=null===o||void 0===o?void 0:o[d],u=(0,c.gl)({id:t.column.id,disabled:s}),{setNodeRef:m,transform:f,isDragging:v}=s?{setNodeRef:null,transform:null,isDragging:!1}:u,x={opacity:v?.8:1,position:s||a?"sticky":"relative",left:s?0:"auto",transform:p.Ks.Transform.toString(f),transition:"width transform 0.2s ease-in-out",width:t.column.getSize(),zIndex:s?2:v?1:a?2:0};return(0,h.jsx)("td",{ref:m,style:x,className:l,title:s?"":"".concat(t.getValue()),children:s?r:(0,h.jsxs)("div",{className:"cell-content",style:{color:g?"red":"inherit",fontWeight:g?"bold":"normal"},children:[r,(0,h.jsx)("style",{children:"\n        .cell-content select {\n          color: ".concat(g?"red":"inherit"," !important;\n          font-weight: ").concat(g?"bold":"normal"," !important;\n        }\n      ")})]})})},x=e=>(console.log("Widget Type:",e),e?"tableColumnOrder_".concat(e):(console.warn("Widget type is missing, using default key"),"tableColumnOrder_default")),w=e=>{let{columns:t,data:n,editable:p=!1,meta:w,type:b,widgetType:y,latestRevision:j,droppedRevision:A,onSelectableRowsChange:D}=e;const N=(0,d.wA)(),[R,C]=(0,s.useState)(n),[S,T]=(0,s.useState)({}),[E,_]=(0,s.useState)(null),I=(0,s.useRef)(null),[k,M]=(0,s.useState)(!1);if((0,s.useEffect)((()=>{const e=e=>{M(e.target.scrollTop>0)},t=I.current;return t&&t.addEventListener("scroll",e),()=>{t&&t.removeEventListener("scroll",e)}}),[]),"Revision_FLoat_Widget"!==y&&"Plant_Assignment_Widget"!==y)var{updateTableData:z}=w;const[O,F]=(0,s.useState)((()=>{const e=x(y),n=localStorage.getItem(e);if(n)try{const e=JSON.parse(n);if(e.every((e=>"selection"===e||t.some((t=>(t.id||t.accessorKey)===e)))))return e}catch(i){console.error("Failed to parse column order for ".concat(y,":"),i)}const o=["selection"],s=t.map((e=>e.id||e.accessorKey));return o.push(...s),o}));(0,s.useEffect)((()=>{const e=x(y);localStorage.setItem(e,JSON.stringify(O))}),[O,y]),console.log("Column Order:",O);const L=(0,s.useMemo)((()=>{const e=["selection"],n=t.map((e=>e.id||e.accessorKey));return e.push(...n),e}),[t]),K=(0,s.useMemo)((()=>{const e={left:["selection","EIN "]};return t.forEach((t=>{t.columnPinning&&e.left.push(t.id||t.accessorKey)})),e}),[t]),W=(0,s.useMemo)((()=>{const e={id:"selection",header:e=>{let{table:t}=e;return(0,h.jsx)("input",{type:"checkbox",ref:e=>{e&&(e.indeterminate=t.getIsSomeRowsSelected())},checked:t.getIsAllRowsSelected(),onChange:t.getToggleAllRowsSelectedHandler()})},cell:e=>{let{row:t}=e;const n=B(t.original);return(0,h.jsx)("input",{type:"checkbox",disabled:!n,style:{cursor:n?"pointer":"not-allowed",opacity:n?1:.5},checked:t.getIsSelected(),onChange:t.getToggleSelectedHandler()})}};return[e,...p?t.map((e=>(0,o.A)((0,o.A)({},e),{},{cell:e.editable?t=>{let{row:n,getValue:s}=t;return(0,h.jsx)("input",{className:"input-cell",value:s(),onChange:t=>((e,t,n)=>{const s=R.map(((s,i)=>i===e?(0,o.A)((0,o.A)({},s),{},{[t]:n}):s));console.log("[Table] Updated Table Data:",s),null!==w&&void 0!==w&&w.updateTableData&&w.updateTableData(s),C(s)})(n.index,e.accessorKey,t.target.value)})}:e.cell}))):t]}),[t,p]),P=(0,l.FR)((0,l.MS)(l.cA,{activationConstraint:{distance:8}}),(0,l.MS)(l.IG,{activationConstraint:{delay:200,tolerance:5}}),(0,l.MS)(l.uN,{}));(0,s.useEffect)((()=>{if("Bos_Attribute_Widget"===y){const e=R.filter(B);D(e)}}),[y,R,D]);const B=e=>"Bos_Attribute_Widget"===y&&"Document"===b?"TRUE"===e.IsLatest:"Bos_Attribute_Widget"!==y||(!j||j===A),H=(0,i.N4)({data:R,columns:W,state:{rowSelection:S,columnOrder:O,columnPinning:K},onRowSelectionChange:T,onColumnOrderChange:F,getCoreRowModel:(0,a.HT)(),getSortedRowModel:(0,a.h5)(),enableRowSelection:e=>B(e.original),defaultColumn:{size:170,minSize:50,maxSize:500},columnResizeMode:"onChange",meta:{updateTableData:z}});(0,s.useEffect)((()=>{const e=H.getSelectedRowModel().flatRows.map((e=>e.original));N((0,u.dT)(e))}),[S,N]);const U=(0,s.useMemo)((()=>{const e=H.getFlatHeaders(),t={};console.log("table.getTotalSize()",H.getTotalSize());for(let n=0;n<e.length;n++){const o=e[n];t["--header-".concat(o.id,"-size")]=o.getSize(),t["--col-".concat(o.column.id,"-size")]=o.column.getSize()}return t}),[H.getState().columnSizingInfo,H.getState().columnSizing]);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{className:"toolkit my-3",children:(0,h.jsx)("div",{className:"d-flex justify-content-end button-container",children:(0,h.jsxs)("div",{className:"d-flex",children:[(0,h.jsx)(g.A,{variant:"outline-primary",size:"lg",onClick:()=>{H.getToggleAllRowsSelectedHandler()({target:{checked:!0}})},className:"m-2",text:"Select All"}),(0,h.jsx)(g.A,{variant:"outline-secondary",size:"lg",onClick:()=>{H.getToggleAllRowsSelectedHandler()({target:{checked:!1}})},className:"m-2",text:"Deselect  All"}),(0,h.jsx)(g.A,{variant:"outline-success",size:"lg",onClick:()=>{console.log("Export button clicked"),console.log("Widget Type in handleExport:",y),"Revision_FLoat_Widget"===y?(console.log("Exporting for Revision_FLoat_Widget"),(0,m.E1)(n,"Where Used Details.xlsx")):"Plant_Assignment_Widget"===y?(console.log("Exporting for Plant_Assignment_Widget"),(0,m.E1)(n,"EAN_Manufacturing.xlsx")):"Bos_Attribute_Widget"===y?(console.log("Exporting for Bos_Attribute_Widget"),(0,m.E1)(n,"Bos_Attribute_Widget.xlsx")):(console.log("Exporting with default filename for widgetType:",y),(0,m.E1)(n,"table-data.xlsx"))},className:"m-2 border-bottom-10px",text:"Export to CSV "}),(0,h.jsx)(g.A,{variant:"outline-warning",size:"lg",onClick:()=>{const e=x(y);localStorage.removeItem(e),F(L)},className:"m-2",text:"Reset Columns"})]})})}),(0,h.jsx)("div",{className:"table-info",children:(0,h.jsxs)("p",{children:[R.length," Items"]})}),(0,h.jsx)(l.Mp,{sensors:P,collisionDetection:l.fp,modifiers:[r.dU],onDragEnd:e=>{const{active:t,over:n}=e;t&&n&&t.id!==n.id&&"selection"!==t.id&&"EIN"!==t.id&&F((e=>{const o=e.indexOf(t.id),s=e.indexOf(n.id);return(0,c.be)(e,o,s)}))},children:(0,h.jsx)("div",{ref:I,className:"table-responsive ".concat(k?"is-scrolled":""),children:(0,h.jsxs)("table",{className:"table custom-table table-hover",style:(0,o.A)((0,o.A)({},U),{},{width:H.getTotalSize()}),children:[(0,h.jsx)("thead",{children:H.getHeaderGroups().map((e=>(0,h.jsx)("tr",{children:(0,h.jsx)(c.gB,{items:H.getVisibleLeafColumns().map((e=>e.id)),strategy:c.m$,children:e.headers.map((e=>(0,h.jsx)(f,{header:e,columns:t,table:H},e.id)))})},e.id)))}),(0,h.jsx)("tbody",{children:H.getRowModel().rows.length>0?H.getRowModel().rows.map((e=>(0,h.jsx)("tr",{onClick:t=>((e,t)=>{const{rows:n,rowsById:o}=H.getRowModel();if(t.shiftKey&&E)try{const t=(0,m.EC)(n,e.id,E),s=o[E].getIsSelected();t.forEach((e=>e.toggleSelected(s)))}catch(s){console.error("Multi-select with shift+click failed:",s)}else e.toggleSelected(!e.getIsSelected());_(e.id)})(e,t),className:S[e.id]?"row-selected":"",children:(0,h.jsx)(c.gB,{items:H.getVisibleLeafColumns().map((e=>e.id)),strategy:c.m$,children:e.getVisibleCells().map((n=>(0,h.jsx)(v,{cell:n,columns:t,changedCells:e.original.changedCells},n.id)))})},e.id))):(0,h.jsx)("tr",{children:(0,h.jsx)("td",{colSpan:H.getHeaderGroups()[0].headers.length,className:"no-data p-2",children:"No Table Data"})})})]})})})]})}},1358:(e,t,n)=>{n.d(t,{A:()=>r});n(5043);var o=n(8012),s=(n(4119),n(3637)),i=n(1397),a=n(4675),l=n(579);const r=()=>{const{handleDrop:e}=(0,o.A)(),{performSearch:t}=(0,a.A)();return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"droppable-container mt-4",children:[(0,l.jsx)(s.A,{style:{width:"90px",height:"90px"},src:"https://thewhitechamaleon.github.io/testrapp/images/drag.png",alt:"Data Collect",className:"search-icon"}),(0,l.jsx)("span",{className:"drag-and-drop-text",children:"Drag and Drop"}),(0,l.jsxs)("div",{className:"divider-container",children:[(0,l.jsx)("hr",{className:"divider"}),(0,l.jsx)("span",{className:"divider-text",children:"or"}),(0,l.jsx)("hr",{className:"divider"})]}),(0,l.jsx)(i.A,{onSearch:n=>{t(n,{title:"Search",role:"",mode:"furtive",default_with_precond:!0,precond:'flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/Raw_Material" OR flattenedtaxonomies:"types/Document"',show_precond:!1,multiSel:!1,idcard_activated:!1,select_result_max_idcard:!1,itemViewClickHandler:"",search_delegation:"3dsearch"},(t=>{t&&t.length>0&&t[0].id?e([{objectId:t[0].id,objectType:t[0]["ds6w:type_value"]}]):console.warn("No objectId found in selected objects")}))}})]})})}},9020:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var o=n(5043),s=n(4391),i=(n(2342),n(9555),n(3003)),a=n(2670),l=n(2115),r=n(1358),c=n(759),d=n(3637),g=n(8012),u=n(6713),m=n(768),p=n(5645),h=n(9379),f=n(3910),v=n(7929),x=n(579);const w=()=>(0,x.jsx)(f.g,{icon:v.e68,className:"green-icon"}),b=()=>(0,x.jsx)(f.g,{icon:v.Jyw,className:"cross-icon"}),y=[{accessorKey:"EIN",header:"EIN",columnPinning:!0},{accessorKey:"Title",header:"Title"},{accessorKey:"Description",header:"Description"},{accessorKey:"Type",header:"Type"},{accessorKey:"Revision",header:"Revision"},{accessorKey:"Connected Child Revision",header:"Connected Revision"},{accessorKey:"Latest child connected",header:"latest Revision Connected",cell:e=>{let{cell:t}=e;return t.getValue()?(0,x.jsx)(w,{}):(0,x.jsx)(b,{})}},{accessorKey:"To-Be child connected",header:"Revision to-be Connected"},{accessorKey:"relationship",header:"Relationship"},{accessorKey:"State",header:"State"},{accessorKey:"Owner",header:"Owner"},{accessorKey:"CAD Format",header:"CAD Format"},{accessorKey:"Collabspace",header:"Collabspace"}];var j=n(3728),A=n(360),D=n(2725),N=n(3277),R=n(6047);var C=n(174);const S=()=>{const{handleDrop:e}=(0,g.A)(),{showSuccessToast:t,showErrorToast:n}=(0,D.A)(),[s,i]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{if(!window.widget)return;console.trace("[WidgetLifecycle] \ud83d\udd04 `onRefresh` was called from:"),window.widget.addEvent("onRefresh",(async()=>{var o,s;const l=(new Error).stack.split("\n"),r=sessionStorage.getItem("userClickedRefresh");if((e=>e.some((e=>e.includes("UWA_Frame_Alone.js")||e.includes("bundle-min.js"))))(l)&&!r)return void console.warn("[WidgetLifecycle] \u26d4 Auto-refresh detected. Ignoring unwanted `onRefresh`.");sessionStorage.removeItem("userClickedRefresh"),i(!0);const c=a.A.getState().droppedObject.droppedObjectData.initialDraggedData;if(null===c||void 0===c||null===(o=c.data)||void 0===o||null===(s=o.items)||void 0===s||!s.length)return console.error("[WidgetLifecycle] \u26a0\ufe0f `initialDraggedData` is missing or invalid:",c),void i(!1);try{await(0,C.M)(c.data.items,e)}catch(d){console.error("[WidgetLifecycle] \u274c Error during refresh:",d),n(N.H6)}finally{i(!1),t(N._l)}}))}),[]),s?(0,x.jsx)(u.A,{}):null},T=()=>{const{replaceRevisions:e}=(0,A.A)(),{showErrorToast:t}=(0,D.A)(),n=(0,i.d4)((e=>e.droppedObject.droppedObjectData)),o=(0,i.d4)((e=>e.droppedObject.selectedTableRows));return(0,x.jsx)("div",{className:"d-flex cta-absolute",children:(0,x.jsx)(j.A,{variant:"outline-secondary",className:"m-2",size:"lg",text:"Replace",onClick:async()=>{var s;if(!o||0===o.length)return void t(N.M9);const i=null===(s=n.parentDetails)||void 0===s?void 0:s.data;if(!i||0===i.length)return void t("No parent details available.");const a=o.filter((e=>"-"!==e["To-Be child connected"]));if(0===a.length)return void t(N.nm);const l=a.map((e=>i.find((t=>t["Dropped Revision ID"]===e["Dropped Revision ID"]))));if(l.some((e=>!e)))return void t("Could not find all corresponding parent details.");const r=await async function(){try{const e=await(0,R._3)();return(await e.getUser()).email}catch(e){return console.error("Error getting user email:",e),null}}();if(!r)throw new Error("User email not found.");const c=n.cardData;(await e(l,c,r)).success}})})},E=()=>{const{initializeDroppableArea:e,loading:t}=(0,g.A)(),n=(0,o.useRef)(0),s=(0,i.wA)(),{cardData:a,parentDetails:l,isDropped:f,initialDraggedData:v}=(0,i.d4)((e=>({cardData:e.droppedObject.droppedObjectData.cardData,parentDetails:e.droppedObject.droppedObjectData.parentDetails,isDropped:e.droppedObject.isDropped,initialDraggedData:e.droppedObject.droppedObjectData.initialDraggedData})),i.bN),w=(0,o.useRef)(!1);(0,o.useEffect)((()=>{w.current||(e(),w.current=!0)}),[e]);const b=(0,o.useMemo)((()=>((e,t)=>e&&Array.isArray(e.data)?e.data.map((e=>(0,h.A)({EIN:e.EIN||"N/A",Title:e.Title||"N/A",Description:e.Description||"N/A",Type:e.Type||"N/A",Revision:e["Dropped Revision"]||"N/A","Dropped Revision ID":e["Dropped Revision ID"]||"N/A","Connected Child Revision":e.connectedChildRev||"N/A","Latest child connected":!e.toBeChildRevConnected,"To-Be child connected":e.toBeChildRevConnected||"-",State:e["Maturity State"]||"N/A",Owner:e.Owner||"N/A","CAD Format":e["CAD Format"]||"N/A",Collabspace:e["Collaborative Space Title"]||"N/A"},"Document"===(null===t||void 0===t?void 0:t.Type)&&{relationship:e.relationship||"N/A"}))):(console.warn("[getTableData] \u26a0\ufe0f No parent details available. Returning empty array."),[]))(l,a)),[l,a]);(0,o.useEffect)((()=>{b.length>0&&console.log("[RevisionFloat] \ud83d\udcca optimizedTableData Updated:",b)}),[b]);const j=(0,o.useMemo)((()=>(e=>e&&"object"===typeof e?(0,h.A)({title:e.Title||"N/A",type:e.Type||"N/A","Maturity State":e["Maturity State"]||"N/A",owner:e.Owner||"N/A","Collaborative Space Title":e["Collaborative Space Title"]||"N/A",Description:e.Description||"N/A","Dropped Revision":e["Dropped Revision"]||"N/A","Latest Released Revision":e["Latest Released Revision"]||"N/A","CAD Format":e["CAD Format"]||"N/A",imageURL:e.imageURL||"https://oi000186152-us1-space.3dexperience.3ds.com/enovia/snresources/images/icons/large/I_VPMNavProduct108x144.png"},"Document"!==e.Type&&{EIN:e.EIN||"N/A","CAD Format":e["CAD Format"]||"N/A"}):null)(a)),[a]),A=(0,o.useCallback)((()=>{f&&(v.length||e(),s((0,p.Rr)(!1)),(a||l.length||v.length)&&(console.log("[handleHomeClick] \ud83d\uddd1 Dispatching reset action..."),s((0,p.um)({cardData:{},parentDetails:[],initialDraggedData:[]}))))}),[s,e,f,v,a,l]),D=(0,o.useMemo)((()=>"Document"===(null===a||void 0===a?void 0:a.Type)?y:y.filter((e=>"relationship"!==e.accessorKey))),[a]);return(0,o.useEffect)((()=>{console.log("[RevisionFloat] State Changes:",{loading:t,isDropped:f})}),[t,f]),(0,x.jsxs)(x.Fragment,{children:[!f&&!t&&(0,x.jsx)(r.A,{}),f&&(0,x.jsxs)(x.Fragment,{children:[t&&(0,x.jsx)(u.A,{}),(0,x.jsx)("div",{className:"content-wrapper py-3 border-bottom",children:(0,x.jsxs)("div",{className:"d-flex",children:[(0,x.jsx)("div",{className:"p-0 pt-4",children:(0,x.jsx)(d.A,{src:"https://thewhitechamaleon.github.io/testrapp/images/home.png",alt:"home-icon",className:"home-icon",onClick:A})}),j&&(0,x.jsx)(c.A,{data:j})]})}),b.length>0?(0,x.jsxs)("div",{className:"wrapper-cta",children:[(0,x.jsx)(T,{}),(0,x.jsx)(m.A,{data:b,columns:D,widgetType:"Revision_FLoat_Widget"},n.current)]}):(0,x.jsx)("div",{className:"no-data-banner",children:"No Parent object(s) found"})]})]})};n(8421),n(4050),n(9959);let _=null;function I(){if(window.widget){let e=!1;window.widget.addEvent("onLoad",(()=>{e?console.warn("[index.js] \u23f3 onLoad was already executed. Ignoring duplicate trigger."):(e=!0,function(){var e,t;requirejs(["DS/PlatformAPI/PlatformAPI"],(e=>{window.PlatformAPI=e}));let n=(null===(e=window.widget)||void 0===e||null===(t=e.body)||void 0===t?void 0:t.querySelector("#root"))||document.getElementById("root");n||(n=document.createElement("div"),n.id="root",window.widget&&window.widget.body?window.widget.body.appendChild(n):document.body.appendChild(n)),_||(_=s.createRoot(n)),_.render((0,x.jsxs)(i.Kq,{store:a.A,children:[(0,x.jsx)(S,{}),(0,x.jsx)(E,{}),(0,x.jsx)(l.N9,{})]}))}())}))}else console.error("[index.js] \u274c Widget not detected! onLoad cannot be registered.")}!function(){if(window.parent&&window.parent.document){let e=window.parent.document.createElement("script");e.textContent='\n    function listenForRefreshClicks() {\n      // console.log("\ud83c\udf0d [Parent] Listening for manual refresh clicks...");\n\n      document.body.addEventListener("click", function (event) {\n        let refreshButton = event.target.closest("#refresh"); // Check if refresh was clicked\n\n        if (refreshButton) {\n          // console.log("\u2705 [Parent] User clicked Refresh!");\n          sessionStorage.setItem("userClickedRefresh", "true"); // Store flag\n          // console.log("Stored Flag:", sessionStorage.getItem("userClickedRefresh"));\n        }\n      }, true);\n    }\n\n    // \u2705 Ensure event listener is added even if DOM is already loaded\n    if (document.readyState === "loading") {\n      document.addEventListener("DOMContentLoaded", listenForRefreshClicks);\n    } else {\n      listenForRefreshClicks();\n    }\n  ',window.parent.document.body.appendChild(e)}else console.warn("\u26a0\ufe0f [index.js] Unable to inject script\u2014parent window not accessible.")}()}}]);
//# sourceMappingURL=754.ca627849.chunk.js.map