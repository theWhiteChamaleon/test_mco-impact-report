"use strict";(self.webpackChunkreact_widget_template=self.webpackChunkreact_widget_template||[]).push([[453],{8453:(e,t,a)=>{a.r(t),a.d(t,{default:()=>M});var n=a(5043),s=a(4391),o=(a(2342),a(9555),a(3003)),l=a(2670),i=a(2115),d=(a(8421),a(4050),a(9959),a(2725)),r=a(6713),c=a(7419),u=a(579);a(45);var p=a(9379),h=(a(4816),a(3637)),m=a(768),g=a(759),A=(a(174),a(5645));a(184);const C=(e,t,a)=>(console.log("cadata datahelpers",a),e?e.map((e=>"Change Action"===t?{ItemName:(null===e||void 0===e?void 0:e.ItemTitle)||"N/A",Plant:(null===e||void 0===e?void 0:e.ItemPlants)||[],ItemId:(null===e||void 0===e?void 0:e.ItemId)||"N/A"}:(console.log("change data datahelper",(null===e||void 0===e?void 0:e.Change)||a.CAName||"N/A"),{Plant:(null===e||void 0===e?void 0:e.title)||"N/A",Seq:(null===e||void 0===e?void 0:e.Seq)||"1",Status:(null===e||void 0===e?void 0:e.PlantStatus)||"Pending","MFG Change":(null===e||void 0===e?void 0:e.MFGChange)||"N/A","MFG Status":(null===e||void 0===e?void 0:e.MFGStatus)||"N/A",Change:(null===e||void 0===e?void 0:e.Change)||a.CAName||"N/A","Change Status":(null===e||void 0===e?void 0:e.ChangeStatus)||a.CAStatus||"N/A","Oracle Template":e.OracleTemplate||"N/A","ERP Status":"Active","ERP Export":"Yes","Lead Plant":!1,MBom:e.MBOM?"Make":"Buy","Sort Value":""}))):[]),v=[{accessorKey:"Available Plant",header:"Available Plant"}];a(3127),a(5362),a(6313),a(3728);const j=e=>{let{onAddPlant:t,addedPlant:a,onSave:n,onRemove:s,uniquedata:o,uniqueColumn:l,CAName:i,state:d,type:r,isMFGCA:c,CAData:u}=e;return console.log("[Unique Table Data]:",o),{}};a(3277),a(4119);var b=a(4282),f=a(2691),w=a(1397),D=a(4675),x=a(3910),S=a(7929);const P=e=>{let{handleFileInputChange:t,fileInputRef:a,isFileInputDisabled:n,handleSubmit:s,isCreateButtonDisabled:o,handleReset:l}=e;const{handleDrop:i}=(0,c.A)(),{performSearch:d}=(0,D.A)();return(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)("div",{className:"droppable-container mt-4",children:[(0,u.jsx)(h.A,{style:{width:"90px",height:"65px"},src:"https://thewhitechamaleon.github.io/testrapp/images/drag.png",alt:"Data Collect",className:"search-icon"}),(0,u.jsx)("span",{className:"drag-and-drop-text",children:"Drag and Drop"}),(0,u.jsxs)("div",{className:"divider-container",children:[(0,u.jsx)("hr",{className:"divider"}),(0,u.jsx)("span",{className:"divider-text",children:"or"}),(0,u.jsx)("hr",{className:"divider"})]}),(0,u.jsx)(w.A,{onSearch:e=>{d(e,{title:"Search",role:"",mode:"furtive",default_with_precond:!0,precond:'flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/Raw_Material" OR flattenedtaxonomies:"types/Document"',show_precond:!1,multiSel:!1,idcard_activated:!1,select_result_max_idcard:!1,itemViewClickHandler:"",search_delegation:"3dsearch"},(e=>{console.log("Selected objects:",e),console.log("objectId: selectedObjects[0].id",e[0].id),e&&e.length>0&&e[0].id?i([{objectId:e[0].id,objectType:e[0]["ds6w:type_value"]}]):console.warn("No objectId found in selected objects")}))}}),(0,u.jsx)("div",{class:"mt-3",children:(0,u.jsxs)("div",{class:"row justify-content-center",children:[(0,u.jsx)("div",{class:"col-6 col-md-auto mb-2",children:(0,u.jsx)(b.A,{variant:"link ms-auto",onClick:()=>{const e=document.createElement("a");e.href="https://github.com/aayush825/EMR_PLANT_WIDGET/raw/main/plant_assignment_template.xlsx",e.download="plant_assignment_template.xlsx",e.click()},children:"Download Template"})}),(0,u.jsx)("div",{class:"col-6 col-md-auto mb-2",children:(0,u.jsx)(f.A.Group,{controlId:"formFileMultiple",children:(0,u.jsx)(f.A.Control,{type:"file",multiple:!0,onChange:t,disabled:n,ref:a})})}),(0,u.jsx)("div",{class:"col-6 col-md-auto mb-2",children:(0,u.jsx)(b.A,{variant:"outline-danger",onClick:l,children:(0,u.jsx)(x.g,{icon:S.ub2})})}),(0,u.jsx)("div",{class:"col-6 col-md-auto mb-2",children:(0,u.jsx)("div",{style:{display:"inline-block",cursor:o?"not-allowed":"pointer"},children:(0,u.jsx)(b.A,{variant:o?"secondary":"outline-primary",onClick:s,disabled:o,children:"Create Manufacturing CA"})})})]})})]})})};var y=a(3353),N=(a(9332),a(2268),a(5658));a(6047);const O=()=>{const{showSuccessToastWithProgress:e,showErrorToastWithProgress:t}=(0,d._)(),[a,s]=(0,n.useState)(!1),[l,i]=(0,n.useState)(null),[b,f]=(0,n.useState)(!1),[w,D]=(0,n.useState)([]),{initializeDroppableArea:x,loading:S}=(0,c.A)(),[O,I]=(0,n.useState)(0),[M,R]=(0,n.useState)([]),[E,F]=(0,n.useState)([]),[T,k]=(0,n.useState)(null),[_,q]=(0,n.useState)([]),[L,G]=(0,n.useState)([]),[K,B]=(0,n.useState)(!1),[U,V]=(0,n.useState)(!0),{handleDrop:W}=(0,c.A)(),[H,z]=(0,n.useState)(!1),[X,Y]=(0,n.useState)(!1),[J,Q]=(0,n.useState)(!1),[Z,$]=(0,n.useState)(!1),ee=(0,o.wA)(),{showSuccessToast:te,showErrorToast:ae}=(0,d.A)();let ne=window.widget.getValue("Credentials");console.log("Security context is: ",ne);const se=(0,n.useRef)(null),oe=(0,n.useCallback)(((e,t)=>{G((a=>a.map((a=>a.ItemId===e?(0,p.A)((0,p.A)({},a),{},{ItemPlants:a.ItemPlants.map((e=>e.PlantID===t?(0,p.A)((0,p.A)({},e),{},{color:"red"===e.color?"green":"red"}):e))}):a))))}),[G]);console.log("Table Data after Adding:",M);const le=(0,o.d4)((e=>e.droppedObject.selectedTableRows)),ie=(0,o.d4)((e=>e.droppedObject.droppedObjectData));console.log("droppedObjectData",ie);const de=(0,o.d4)((e=>e.droppedObject.CAItemObjectDetails.CAItemDetails));console.log("The CA Item Details are:",de);const re=(0,o.d4)((e=>e.droppedObject.CAItemObjectDetails.CAallPlants));console.log("For CA all Plants are: ",re);const ce=(0,o.d4)((e=>e.droppedObject.CAItemObjectDetails.CAheaders));console.log("caheaders plant assign",ce);const ue=(0,o.d4)((e=>e.droppedObject.CAItemObjectDetails.CAisMFGCA));console.log("isMFGCA value is:",ue);const pe=(0,o.d4)((e=>e.droppedObject.loadingParentDetails));console.log("Parents Loading State:",pe);const he=(0,o.d4)((e=>e.droppedObject.plantObjectData.proposedChanges));console.log("Proposed Changes are:",he);const me=(0,o.d4)((e=>e.droppedObject.isDropped)),ge=(0,o.d4)((e=>e.droppedObject.plantObjectData.allPlants));console.log("[MBOMImpactReport] plant object data: ",ge);const Ae=(0,o.d4)((e=>e.droppedObject.plantObjectData.uniquePlants));console.log("[Plant Assignment] Unique Plants:",Ae);const Ce=(0,o.d4)((e=>e.droppedObject.plantObjectData.initialAssignedPlants));console.log("The Assigned Plants are:",Ce);const ve=(0,o.d4)((e=>e.droppedObject.plantObjectData.CAData));console.log("The CAData is....:",ve);const je=(0,o.d4)((e=>e.droppedObject.plantObjectData.productChildren));console.log("[Plant Assignment] Product Children:",je);const be=(0,o.d4)((e=>e.droppedObject.plantObjectData.CAName));console.log("[plant Assignment] CAName:",be);const fe=(0,o.d4)((e=>e.droppedObject.plantObjectData.headers));console.log("[Plant Assignment] Headers are: ",fe);const we=(0,n.useCallback)((()=>{let e=re.map((e=>e.title.replace(/^Plant /,"")));const t=0===le.length?M:le;let a=[...new Set(t.flatMap((e=>{var t;return(null===(t=e.Plant)||void 0===t?void 0:t.map((e=>e.PlantName)))||[]})))],n=e.filter((e=>!a.includes(e))).map((e=>({title:e})));return console.log("Unique table plants are :",n),e.map((e=>({title:e})))}),[re,M,le,ue]);if(console.log("Tanble Data is:",M),(0,n.useEffect)((()=>{M.length>=0&&I((e=>e+1))}),[M]),ie.cardData&&ie.initialDraggedData)var De,xe,Se=ie.cardData["Maturity State"],Pe=(ie.cardData.HasMBOM,null===(De=ie.initialDraggedData)||void 0===De||null===(xe=De.data)||void 0===xe?void 0:xe.items[0].objectType);const[ye,Ne]=(0,n.useState)(Ce);console.log("Duplicate Initial Assigned Classes are:",ye),(0,n.useEffect)((()=>{Ne(Ce),"Change Action"===Pe?G(de):F(Ce)}),[Ce,Pe,de]),(0,n.useEffect)((()=>{"Change Action"===Pe&&q(we())}),[we,Pe]),(0,n.useEffect)((()=>{"Change Action"!==Pe&&q(Ae)}),[Ae,Pe]);(0,n.useEffect)((()=>{me||x()}),[me,x]),(0,n.useEffect)((()=>{z(pe)}),[pe]);const Oe=(0,n.useMemo)((()=>C("Change Action"===Pe?L:E,Pe,ve)),[L,E,Pe,ve]),Ie=(0,n.useMemo)((()=>(e=>e?e.map((e=>({"Available Plant":(null===e||void 0===e?void 0:e.title)||"N/A"}))):[])(_)),[_]);console.log("[Plant Assignment] Unique Table Data:",Ie);const Me=(0,n.useMemo)((()=>(e=>{if(!e||!e.cardData)return null;const t=e.cardData;let a={title:t.Title||"N/A",type:t.Type||"N/A","Maturity State":t["Maturity State"]||"N/A",owner:t.Owner||"N/A","Collaborative Space Title":t["Collaborative Space Title"]||"N/A",Description:t.Description||"N/A","Dropped Revision":t["Dropped Revision"]||"N/A","Latest Released Revision":t["Latest Released Revision"]||"N/A","CAD Format":t["CAD Format"]||"N/A",imageURL:t.imageURL||"https://oi000186152-us1-space.3dexperience.3ds.com/enovia/snresources/images/icons/large/I_VPMNavProduct108x144.png"};return"Document"!==t.Type&&(a.EIN=t.EIN||"N/A",a["CAD Format"]=t["CAD Format"]||"N/A"),a})(ie)),[ie]);console.log(Me),(0,n.useEffect)((()=>{Oe.length>=0&&(console.log("New Table Data:",Oe),R(Oe),I((e=>e+1)))}),[Oe]),(0,n.useEffect)((()=>{Q(!!Me)}),[Me]);const Re=(0,n.useMemo)((()=>((e,t)=>(console.log("type here is: ",t),[{accessorKey:"Plant",header:"Plant"},{accessorKey:"Seq",header:"Seq"},{accessorKey:"Status",header:"Status"},{accessorKey:"Change",header:"Change"},{accessorKey:"Change Status",header:"Change Status"},{accessorKey:"MFG Change",header:"MFG Change"},{accessorKey:"MFG Status",header:"MFG Status"},{accessorKey:"Oracle Template",header:"Oracle"},{accessorKey:"MBom",header:"MBom"},{accessorKey:"ERP Status",header:"ERP Status"},{accessorKey:"ERP Export",header:"ERP Export"},{accessorKey:"Lead Plant",header:"Lead Plant"},{accessorKey:"Sort Value",header:"Sort Value"}]))(0,Pe)),[be,Pe,Z,oe]),Ee=(0,n.useMemo)((()=>v),[]);(0,n.useEffect)((()=>{console.log("[MBOMImpactReport] State Changes:",{loading:S,loadingParentDetails:pe,isDropped:me})}),[S,pe,me]);const Fe=()=>{i(null),k(null),D([]),f(!1),R([]),q([]),G([]),F([]),Ne([]),I(0),B(!1),se.current&&(se.current.value=""),V(!0)};return(0,u.jsxs)(u.Fragment,{children:[X&&(0,u.jsx)(r.A,{}),!me&&!S&&!H&&(0,u.jsx)("div",{style:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",position:"relative"},children:(0,u.jsx)(P,{handleFileInputChange:e=>{(0,N.fp)(e,D,f,ae,te,i,k,V).finally((()=>{Y(!1)})),B(!0)},fileInputRef:se,isFileInputDisabled:K,handleSubmit:async()=>{if(l){Y(!0);try{await(0,N.uk)(l,e,t,Fe)}catch(a){console.error("Error in handleSubmit:",a)}finally{Y(!1)}V(!0)}else ae("Please upload and validate a file before proceeding.")},isCreateButtonDisabled:U,handleReset:Fe})}),me&&(0,u.jsxs)(u.Fragment,{children:[S&&(0,u.jsx)(r.A,{}),(0,u.jsx)("div",{className:"content-wrapper py-3 border-bottom",children:(0,u.jsxs)("div",{className:"d-flex ",children:[(0,u.jsx)("div",{className:" p-0 pt-4",children:(0,u.jsx)(h.A,{src:"https://thewhitechamaleon.github.io/testrapp/images/home.png",alt:"home-icon",className:"home-icon",onClick:()=>{x(),ee((0,A.Rr)(!1)),ee((0,A.um)({cardData:{},parentDetails:[],versions:[],initialDraggedData:[]})),ee((0,A.Lq)({allPlants:[],initialAssignedPlants:[],uniquePlants:[],productChildren:[],CAName:!1,headers:{},proposedChanges:[],CAData:{}})),ee((0,A.XC)({CAItemDetails:[],CAallPlants:[],CAisMFGCA:!1,CAheaders:{}})),R([]),Q(!1)}})}),Me&&(0,u.jsx)(g.A,{data:Me,widgetType:"MBOMImpactReport"})]})}),H?(0,u.jsx)("div",{className:"loading-indicator mt-5",children:(0,u.jsx)(r.A,{})}):(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)("div",{className:"wrapper-cta",children:[(0,u.jsx)(j,{uniquedata:Ie,uniqueColumn:Ee,CAName:be,state:Se,type:Pe,isMFGCA:ue,CAData:ve}),(0,u.jsx)(m.A,{data:M,columns:Re,widgetType:"Plant_Assignment_Widget"},O)]})})]}),(0,u.jsx)(y.A,{show:b,onHide:()=>f(!1),errors:w})]})};let I=null;function M(){if(window.widget){let e=!1;window.widget.addEvent("onLoad",(()=>{e?console.warn("[index.js] \u23f3 onLoad was already executed. Ignoring duplicate trigger."):(e=!0,function(){var e,t;requirejs(["DS/PlatformAPI/PlatformAPI"],(e=>{window.PlatformAPI=e}));let a=(null===(e=window.widget)||void 0===e||null===(t=e.body)||void 0===t?void 0:t.querySelector("#root"))||document.getElementById("root");a||(a=document.createElement("div"),a.id="root",window.widget&&window.widget.body?window.widget.body.appendChild(a):document.body.appendChild(a)),I||(I=s.createRoot(a)),I.render((0,u.jsxs)(o.Kq,{store:l.A,children:[(0,u.jsx)(O,{}),(0,u.jsx)(i.N9,{})]}))}())}))}else console.error("[index.js] \u274c Widget not detected! onLoad cannot be registered.")}!function(){if(window.parent&&window.parent.document){let e=window.parent.document.createElement("script");e.textContent='\n    function listenForRefreshClicks() {\n      // console.log("\ud83c\udf0d [Parent] Listening for manual refresh clicks...");\n\n      document.body.addEventListener("click", function (event) {\n        let refreshButton = event.target.closest("#refresh"); // Check if refresh was clicked\n\n        if (refreshButton) {\n          // console.log("\u2705 [Parent] User clicked Refresh!");\n          sessionStorage.setItem("userClickedRefresh", "true"); // Store flag\n          // console.log("Stored Flag:", sessionStorage.getItem("userClickedRefresh"));\n        }\n      }, true);\n    }\n\n    // \u2705 Ensure event listener is added even if DOM is already loaded\n    if (document.readyState === "loading") {\n      document.addEventListener("DOMContentLoaded", listenForRefreshClicks);\n    } else {\n      listenForRefreshClicks();\n    }\n  ',window.parent.document.body.appendChild(e)}else console.warn("\u26a0\ufe0f [index.js] Unable to inject script\u2014parent window not accessible.")}()}}]);
//# sourceMappingURL=453.ccc84afb.chunk.js.map